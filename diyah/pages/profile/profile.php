<?phpsession_start();if(empty($_SESSION)) {	header("location:../../index.php");} else {	include("../../inc/koneksi.php");	include("../../template/header.php");	include("../../template/sidebar.php");?><style type='text/css'>	.cropit-preview {		background-color: #f8f8f8;		background-size: cover;		border: 1px solid #ccc;		border-radius: 50%;		margin-top: 7px;		width: 244px;		height: 244px;		cursor: move;	}	.cropit-preview-image-container {		border-radius: 50%;		overflow: hidden;		z-index: 1070;	}	.image-size-label {		float: center;	}</style><section class="content">	<div class="box">		<div class="col-xs-12">			<h2 class="page-header">				Profile			</h2>		</div>		<div class="box-body">			<?php				if(isset($_POST["username"])) {										if(isset($_POST["foto_user"]) && $_POST["foto_user"] != "") {						$query = mysqli_query($conn, "SELECT foto FROM users WHERE kode_user=".$_SESSION["kode"]);						$row = mysqli_fetch_assoc($query);						if(file_exists("../../template/assets/images/foto-profil/{$row["foto"]}")) {							if($row["foto"] != "def_avatar.png") {								unlink("../../template/assets/images/foto-profil/{$row["foto"]}");							}						}												$nama_foto = md5(date("dmYHis").$_SESSION["username"].$_SESSION["kode"]) . ".jpg";												$query = mysqli_query($conn, "UPDATE users SET foto='{$nama_foto}' WHERE kode_user=".$_SESSION["kode"]);						if($query) {							$base64_foto = str_replace("data:image/jpeg;base64,", "", $_POST["foto_user"]);							file_put_contents("../../template/assets/images/foto-profil/{$nama_foto}", base64_decode($base64_foto));							$_SESSION["foto"] = $nama_foto;							echo "								<script type='text/javascript'>									$(document).ready(function() {										$('#foto_di_header').attr('src', '../../template/assets/images/foto-profil/{$nama_foto}');										$('#foto_di_sidebar').attr('src', '../../template/assets/images/foto-profil/{$nama_foto}');									});								</script>							";						}					}										$salah = 0;					$curr_username = mysqli_real_escape_string($conn, $_SESSION["username"]);					$username = mysqli_real_escape_string($conn, $_POST["username"]);					$nama_user = mysqli_real_escape_string($conn, $_POST["nama_user"]);					$password_baru = $_POST["input_password_baru"];					$konfirmasi = $_POST["input_konfirmasi"];									if(empty($password_baru) && empty($konfirmasi)) {						$ganti_password = "";					} else {						if(md5($password_baru) === md5($konfirmasi)) {							$ganti_password = ", password='".md5($password_baru)."'";						} else {							$salah = 1;						}					}										if($salah === 0) {						if($username === $curr_username) {							$ganti_username = "";						} else {							$query = mysqli_query($conn, "SELECT * FROM users WHERE username='$username' AND kode_user<>".$_SESSION["kode"]);							if($query) {								$n = mysqli_num_rows($query);								if($n == 0) {									$ganti_username = ", username='$username'";								} else {									$salah = 2;								}							} else {								$salah = 2;							}						}					}										if($salah === 0) {						$query = mysqli_query($conn, "UPDATE users SET nama_user='{$nama_user}'{$ganti_username}{$ganti_password} WHERE kode_user=".$_SESSION["kode"]);						if($query) {							$_SESSION["username"] = $_POST["username"];							$_SESSION["nama"] = $_POST["nama_user"];						} else {							$salah = 3;						}					}										if($salah === 0) {						$info = "<b>Berhasil</b> menyimpan perubahan!";						$warna = array("success", "check");					} else if($salah === 1) {						$info = "<b>Gagal</b> menyimpan perubahan. Password tidak cocok!";						$warna = array("danger", "times");					} else if($salah === 2) {						$info = "<b>Gagal</b> menyimpan perubahan. Username sudah ada!";						$warna = array("danger", "times");					} else if($salah === 3) {						$info = "<b>Gagal</b> menyimpan perubahan!";						$warna = array("danger", "times");					}										echo "						<br/><br/>						<div class='alert alert-{$warna[0]} fade in'>							<a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a>							<i class='fa fa-{$warna[1]}-sign'></i>&nbsp;{$info}						</div>					";				}			?>			<form method="POST" action="">				<div class='form-group'>					<label>Username:</label>					<input type='text' class='form-control' value="<?php echo htmlspecialchars($_SESSION["username"]); ?>" name='username'>				</div>				<div class='form-group'>					<label>Nama:</label>					<input type='text' class='form-control' value="<?php echo htmlspecialchars($_SESSION["nama"]); ?>" name="nama_user">				</div>				<div  class='form-group'>					<label>Foto:</label><br/>					<input type="hidden" id="image-data" name="foto_user">					<img src="../../template/assets/images/foto-profil/<?php echo $_SESSION["foto"]; ?>" style="width:242px;border-radius:50%;" id="preview_foto"><br/>					<button type="button" class='btn btn-primary' data-toggle="modal" data-target="#dlg-foto" style="margin-top:8px;width:120px;"><i class='fa fa-image'></i> Pilih Foto</button>					<button type="button" class='btn btn-danger' onclick="resetFoto();" style="margin-top:8px;width:120px;"><i class='fa fa-refresh'></i> Reset Foto</button>				</div>				<div class='form-group'>					<label>Password Baru:</label>					<input type='password' class='form-control' placeholder='Masukkan password baru (Kosongi jika tidak diganti)' name='input_password_baru'>				</div>				<div class='form-group'>					<label>Konfirmasi Password Baru:</label>					<input type='password' class='form-control' placeholder='Konfirmasi password baru (Kosongi jika tidak diganti)' name='input_konfirmasi'>					</div>				<div class='form-group'>					<br/>					<button type="submit" class='btn btn-success btn-block'><i class='fa fa-floppy-o'></i>&nbsp;Simpan</button>				</div>			</form>		</div>	</div></section><div class="modal fade" id="dlg-foto" role="dialog" aria-hidden="true">	<div class="modal-dialog">		<div class="modal-content">			<div class="modal-header header-primary">				<button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-times"></i></button>				<h4 class="modal-title"><b><i class='fa fa-image'></i>&nbsp;Pilih Foto</b></h4>			</div>			<div class="modal-body">				<div id="image-editor">					<center>						<input type="file" class="cropit-image-input" style='width:240px;' id="input-foto">						<div class="cropit-preview"></div>						<br/>						<span class="image-size-label">Resize foto</span>						<i class='fa fa-image' style='float:left;'></i>						<i class='fa fa-image fa-2x' style='float:right;'></i>						<input type="range" class="cropit-image-zoom-input">					</center>				</div>			</div>			<div class="modal-footer">				<button type="button" class="btn btn-default" onclick='gantiFoto();' id='btn-ganti-foto'><i class='fa fa-check'></i>&nbsp;OK</button>				<button type="button" class="btn btn-default" data-dismiss="modal"><i class='fa fa-times'></i>&nbsp;Batal</button>			</div>		</div>	</div></div><script type='text/javascript'>	$(document).ready(function() {		$('#image-editor').cropit();	});	function gantiFoto() {		var imageData = $('#image-editor').cropit('export', {		  type: 'image/jpeg',		  quality: .9,		  originalSize: false		});		$('#image-data').val(imageData);		if($('#image-data').val() == "") {			BootstrapDialog.alert("Anda harus memilih foto atau klik <i><b>\"Batal\"</b></i> jika tidak ingin mengganti.")			return;		} else {			$("#preview_foto").attr("src", $('#image-data').val());			$("#dlg-foto").modal("hide");		}	}	function resetFoto() {		$("#preview_foto").attr("src", "../../template/assets/images/foto-profil/<?php echo $_SESSION["foto"]; ?>");		$('#image-data').val("");	}</script><?php		include("../../template/footer.php");	}?>