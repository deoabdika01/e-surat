<?phpsession_start();include("../../inc/koneksi.php");$s = isset($_POST["search"]) ? mysqli_real_escape_string($conn, $_POST["search"]["value"]) : "";$p = isset($_POST["start"]) && $_POST["start"] != "" && is_numeric($_POST["start"]) ? intval($_POST["start"]) : 0;$e = isset($_POST["length"]) && $_POST["length"] != "" && is_numeric($_POST["length"]) ? intval($_POST["length"]) : 10;$c = array(    "permintaan.tanggal",    "permintaan.nama_barang",    "permintaan.jumlah",    "permintaan.status",    "users.nama_user");$o = isset($_POST["order"]) ? array($c[intval($_POST["order"][0]["column"])], strtoupper($_POST["order"][0]["dir"])) : array($c[0], "DESC");$result["draw"] = $_POST["draw"];$dari = isset($_POST["dari"]) ? $_POST["dari"] : date("d-m-Y");$dari = explode("-", $dari);$dari = "{$dari[2]}-{$dari[1]}-{$dari[0]}";$sampai = isset($_POST["sampai"]) ? $_POST["sampai"] : date("d-m-Y");$sampai = explode("-", $sampai);$sampai = "{$sampai[2]}-{$sampai[1]}-{$sampai[0]}";$filter = "AND (permintaan.tanggal BETWEEN '{$dari}' AND '{$sampai}')";$query = mysqli_query($conn, "SELECT COUNT(*) AS total FROM permintaan");$row = mysqli_fetch_assoc($query);$result["recordsTotal"] = intval($row["total"]);$query = mysqli_query($conn, "SELECT COUNT(*) AS filtered FROM permintaan, users WHERE users.kode_user=permintaan.kode_user {$filter} AND (permintaan.nama_barang LIKE '%{$s}%' OR users.nama_user LIKE '%{$s}%')");$row = mysqli_fetch_assoc($query);$result["recordsFiltered"] = intval($row["filtered"]);$query = mysqli_query($conn, "SELECT permintaan.*, users.nama_user FROM permintaan, users WHERE users.kode_user=permintaan.kode_user {$filter} AND (permintaan.nama_barang LIKE '%{$s}%' OR users.nama_user LIKE '%{$s}%') ORDER BY {$o[0]} {$o[1]} LIMIT {$p},{$e}");$result["data"] = array();$baris = 0;$admin = $_SESSION["level"] == "pegawai";while ($row = mysqli_fetch_assoc($query)) {    if ($admin) {        $tombol = array(            "<button class='btn btn-success btn-tooltip btn-aksi-sm-left' onclick='edit({$baris});' title='Edit'><i class='fa fa-pencil'></i></button>",            "<button class='btn btn-danger btn-tooltip btn-aksi-sm-right' onclick='hapus({$baris});' title='Hapus'><i class='fa fa-trash'></i></button>"        );    } else {        $tombol = array(            "<button class='btn btn-success btn-tooltip btn-aksi-sm-left' onclick='terima({$baris});' title='Terima'><i class='fa fa-check-circle'></i></button>",            "<button class='btn btn-danger btn-tooltip btn-aksi-sm-right' onclick='tolak({$baris});' title='Tolak'><i class='fa fa-times-circle'></i></button>",            "<button class='btn btn-primary btn-tooltip btn-aksi-sm-right' onclick='print_laporan({$baris});' style='width:110px;' title='Print Laporan'><i class='fa fa-print'></i> Print Laporan</button>"        );    }    array_push($result["data"], array(        $row["tanggal"],        htmlspecialchars($row["nama_barang"]),        number_format($row["jumlah"]),        intval($row["status"]) == 0 ? "PENDING" : (intval($row["status"]) == 1 ? "DITERIMA" : "DITOLAK"),        htmlspecialchars($row["nama_user"]),        intval($row["status"]) == 0 ? "<center><div style='width:88px;'>{$tombol[0]}{$tombol[1]}</div></center>" : (!$admin && intval($row["status"]) == 1 ? "<center>{$tombol[2]}</center>" : "<center><b>-</b></center>"),        array(            $row["kode_permintaan"],            $row["jumlah"],            $row["status"]        )    ));    $baris++;}echo json_encode($result);?>